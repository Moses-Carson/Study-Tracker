<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Study Tracker</title>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8SSFK9Q8NE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-8SSFK9Q8NE');
</script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">

<style>
  :root{
    --red:#e11d1d;
    --black:#070707;
    --white:#ffffff;
    --muted: rgba(255,255,255,0.85);
    --card: rgba(255,255,255,0.03);
    --glass: rgba(255,255,255,0.04);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    color:var(--white);
    background: linear-gradient(120deg,#110000 0%, #000000 40%, #0b0b0b 100%);
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:28px;
  }

  .app {
    width:100%;
    max-width:1100px;
  }

  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{
    width:56px;height:56px;border-radius:12px;
    background:linear-gradient(135deg,var(--red),#9b0a0a);
    display:flex;align-items:center;justify-content:center;font-weight:700;color:white;font-size:18px;
    box-shadow:0 8px 30px rgba(225,29,29,0.12);
  }
  h1{margin:0;font-size:20px}

  /* layout */
  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
  @media (max-width:980px){ .grid{grid-template-columns:1fr} }

  /* card */
  .card{
    background:var(--card);
    padding:16px;border-radius:12px;backdrop-filter: blur(6px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.55);
  }

  /* login view */
  #loginView{max-width:720px;margin:0 auto}
  .form-row{display:flex;gap:8px;flex-wrap:wrap}
  input[type=text], input[type=email], input[type=password], input[type=number], input[type=date], select {
    padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--white);min-width:160px;
  }
  .btn{
    padding:10px 12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--red), #a60f0f);color:white;font-weight:700;cursor:pointer;
    box-shadow: 0 8px 24px rgba(166,15,15,0.12);
  }
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);box-shadow:none}
  .small{font-size:13px;color:var(--muted)}

  /* dashboard */
  .welcome {
    font-size:18px;font-weight:700;
    padding:8px 12px;border-radius:10px;background:linear-gradient(90deg, rgba(225,29,29,0.12), rgba(0,0,0,0.2));
    display:inline-block;
    animation: glowText 3s ease-in-out infinite;
  }
  @keyframes glowText {
    0%{box-shadow:0 0 0 rgba(225,29,29,0)}
    50%{box-shadow:0 0 18px rgba(225,29,29,0.14)}
    100%{box-shadow:0 0 0 rgba(225,29,29,0)}
  }

  .stats{display:flex;gap:12px;flex-wrap:wrap}
  .stat{background:var(--glass);padding:12px;border-radius:10px;min-width:110px;text-align:center}
  .stat .big{font-size:20px;font-weight:700}

  /* circular progress */
  .circle-wrap{display:flex;align-items:center;flex-direction:column;gap:12px;padding:8px}
  .progress-svg{transform:rotate(-90deg);}
  .progress-label{position:relative;top:-84px;font-size:18px;font-weight:700;color:var(--white);text-shadow:0 2px 8px rgba(0,0,0,0.6)}

  /* topics */
  .topics{margin-top:12px}
  .topic{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;margin-bottom:8px;background:rgba(255,255,255,0.02)}
  .topic input[type=checkbox]{transform:scale(1.25);accent-color:var(--red)}
  .topic .title{flex:1}
  .topic .actions{display:flex;gap:8px}

  /* right column */
  aside .card{position:sticky;top:24px}

  /* small controls */
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}

  /* subtle transitions */
  button,input,select {transition:all .18s ease}
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">ST</div>
        <div>
          <h1>Study Tracker</h1>
          <div class="small">Track your study â€” Simply and efficiently</div>
        </div>
      </div>
      <div id="rightHeader" class="small"></div>
    </header>

    <!-- LOGIN -->
    <div id="loginView" class="card">
      <h2 style="margin:0 0 10px 0">Sign up / Sign in</h2>
      <div class="form-row">
        <input id="nameIn" type="text" placeholder="Full name (e.g. Moses Carson)" value="">
        <input id="emailIn" type="email" placeholder="Email (e.g. you@school.edu)">
        <input id="deptIn" type="text" placeholder="Department (e.g. MLS)">
      </div>
      <div style="display:flex;gap:8px;margin-top:12px">
        <button id="signupBtn" class="btn">Sign Up</button>
        <button id="signinBtn" class="btn ghost">Sign In</button>
        <button id="guestBtn" class="btn ghost">Continue as Guest</button>
        <button id="demoBtn" class="btn ghost">Demo Data</button>
      </div>
      <div style="margin-top:10px" class="small">A chance to build that GP.</div>
    </div>

    <!-- DASHBOARD -->
    <div id="dashView" style="display:none">
      <div class="grid">
        <main>
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
              <div>
                <div class="small">Welcome</div>
                <div id="welcomeName" class="welcome">Student</div>
                <div id="welcomeDept" class="small" style="margin-top:6px">Department</div>
              </div>

              <div class="circle-wrap">
                <svg class="progress-svg" width="170" height="170" viewBox="0 0 170 170">
                  <defs>
                    <linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="0%">
                      <stop offset="0%" stop-color="#ff6b6b"/>
                      <stop offset="100%" stop-color="#ff0000"/>
                    </linearGradient>
                  </defs>
                  <circle cx="85" cy="85" r="70" stroke="rgba(255,255,255,0.08)" stroke-width="12" fill="none"></circle>
                  <circle id="progBar" cx="85" cy="85" r="70" stroke="url(#g1)" stroke-width="12" stroke-linecap="round" fill="none"
                    stroke-dasharray="439.82" stroke-dashoffset="439.82" style="transition:stroke-dashoffset .6s ease, filter .6s ease;"></circle>
                </svg>
                <div class="progress-label" id="progressLabel">0%</div>
              </div>
            </div>

            <div class="stats" style="margin-top:12px">
              <div class="stat"><div class="small">Completed</div><div class="big" id="completedCount">0</div></div>
              <div class="stat"><div class="small">Remaining</div><div class="big" id="remainingCount">0</div></div>
              <div class="stat"><div class="small">Daily target</div><div class="big" id="dailyTarget">0</div></div>
            </div>

            <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;align-items:center">
              <label class="small">Start date <input id="startDate" type="date" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit" /></label>
              <label class="small">Duration (days) <input id="durationDays" type="number" min="1" value="30" style="width:80px;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit" /></label>
              <label class="small">Daily target <input id="dailyTargetInput" type="number" min="1" value="1" style="width:80px;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit" /></label>
              <button id="savePlan" class="btn ghost">Save</button>
            </div>
          </div>

          <div class="card topics" style="margin-top:12px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:700">Your Topics</div>
              <div class="small">Add, edit or mark topics complete</div>
            </div>

            <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
              <input id="newTopic" type="text" placeholder="Topic title (e.g. Glycolysis - Steps)" style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit" />
              <button id="addTopic" class="btn">+ Add Topic</button>
            </div>

            <div id="topicsList" style="margin-top:12px;min-height:120px"></div>

            <div class="controls" style="margin-top:12px">
              <button id="editTopics" class="btn ghost">Edit topics (bulk)</button>
              <button id="download" class="btn ghost">Download</button>
              <button id="restore" class="btn ghost">Restore</button>
              <button id="resetAll" class="btn" style="background:var(--red)">Reset All</button>
            </div>
          </div>
        </main>

        <aside>
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:700">Reminders</div>
              <div class="small">Set daily reminder</div>
            </div>

            <div style="margin-top:10px">
              <label class="small">Reminder time <input id="reminderTime" type="time" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit" /></label>
              <div style="margin-top:8px;display:flex;gap:8px">
                <button id="saveReminder" class="btn">Save</button>
                <button id="clearReminder" class="btn ghost">Clear</button>
              </div>
              <div id="reminderStatus" class="small" style="margin-top:8px"></div>
            </div>

            <hr style="margin:12px 0;border-color:rgba(255,255,255,0.04)" />

            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:700">Backgrounds</div>
              <div class="small">Customize</div>
            </div>
            <div style="margin-top:10px" id="bgList"></div>

            <div style="margin-top:12px;display:flex;gap:8px">
              <button id="copyLink" class="btn ghost">Copy Page Link</button>
              <button id="deployGuide" class="btn ghost">Deploy Guide</button>
            </div>
          </div>
        </aside>
      </div>

      <div style="margin-top:12px;text-align:center;color:rgba(255,255,255,0.65);font-size:13px">Your data is stored locally â€” we can migrate to Firebase later without losing UI.</div>
    </div>
  </div>

  <audio id="checkSound" src="https://www.soundjay.com/buttons/sounds/button-09.mp3" preload="auto"></audio>

<script>
/* -------------------------
   Local keys & state
   ------------------------- */
const KEY_USER = 'st_user_v2';
const KEY_TOPICS = 'st_topics_v2';
const KEY_PLAN = 'st_plan_v2';
const KEY_REMINDER = 'st_reminder_v2';
const KEY_BG = 'st_bg_v2';

let state = {
  user: null,
  topics: [],
  plan: { startDate: null, durationDays: 30, dailyTarget: 1 },
  reminder: null,
  bgList: []
};

const $ = id => document.getElementById(id);
const saveJSON = (k,v) => localStorage.setItem(k, JSON.stringify(v));
const loadJSON = (k, fallback) => {
  try { const s = localStorage.getItem(k); return s ? JSON.parse(s) : fallback; } catch(e){ return fallback; }
};

/* -------------------------
   Init
   ------------------------- */
function init(){
  state.user = loadJSON(KEY_USER, null);
  state.topics = loadJSON(KEY_TOPICS, []);
  state.plan = loadJSON(KEY_PLAN, state.plan);
  state.reminder = loadJSON(KEY_REMINDER, null);
  state.bgList = loadJSON(KEY_BG, []);
  // wire UI
  bindUI();
  if(state.user) showDashboard();
  updateReminderUI();
  renderTopics();
  updateStats();
  startReminderChecker();
}
init();

/* -------------------------
   UI bindings
   ------------------------- */
function bindUI(){
  $('signupBtn').addEventListener('click', signup);
  $('signinBtn').addEventListener('click', signin);
  $('guestBtn').addEventListener('click', guestSignIn);
  $('demoBtn').addEventListener('click', demoData);
  $('logoutBtn').addEventListener('click', logout);

  $('addTopic').addEventListener('click', ()=>{ const t=$('newTopic').value.trim(); if(!t) return; state.topics.push({ title:t, done:false }); saveJSON(KEY_TOPICS,state.topics); $('newTopic').value=''; renderTopics(); updateStats(); });
  $('editTopics').addEventListener('click', editTopicsBulk);
  $('download').addEventListener('click', downloadData);
  $('restore').addEventListener('click', restoreFromFile);
  $('resetAll').addEventListener('click', resetAll);

  $('savePlan').addEventListener('click', savePlan);
  $('saveReminder').addEventListener('click', saveReminder);
  $('clearReminder').addEventListener('click', clearReminder);

  $('copyLink').addEventListener('click', ()=>{ navigator.clipboard.writeText(location.href).then(()=> alert('Link copied')); });
  $('deployGuide').addEventListener('click', ()=>{ alert('Deploy: commit index.html to repo root, enable GitHub Pages on main branch.'); });

  // login persistence if present
  if(state.user){
    $('nameIn').value = state.user.name || '';
    $('emailIn').value = state.user.email || '';
    $('deptIn').value = state.user.department || '';
  }
}

/* -------------------------
   Auth (local)
   ------------------------- */
function signup(){
  const name = $('nameIn').value.trim();
  const email = $('emailIn').value.trim();
  const dept = $('deptIn').value.trim();
  if(!name){ alert('Enter a name'); return; }
  state.user = { name, email, department: dept, created: Date.now() };
  saveJSON(KEY_USER, state.user);
  showDashboard();
}
function signin(){
  const saved = loadJSON(KEY_USER, null);
  const email = $('emailIn').value.trim();
  if(!saved || (email && saved.email !== email)){
    alert('No local account found with that email. Please Sign up or use Demo / Guest.');
    return;
  }
  state.user = saved;
  saveJSON(KEY_USER, state.user);
  showDashboard();
}
function guestSignIn(){
  state.user = { name: 'Guest', email: `guest_${Date.now()}@local`, department: '' };
  saveJSON(KEY_USER, state.user);
  showDashboard();
}
function demoData(){
  state.user = { name: 'Moses Carson', email: 'moses.carson@example.com', department: 'MLS' };
  state.topics = [
    { title:'Introduction to Metabolism', done:false },
    { title:'Glycolysis overview', done:false },
    { title:'TCA cycle essentials', done:false },
    { title:'Lipid digestion & absorption', done:false }
  ];
  state.plan = { startDate: new Date().toISOString().slice(0,10), durationDays:30, dailyTarget:1 };
  saveJSON(KEY_USER, state.user);
  saveJSON(KEY_TOPICS, state.topics);
  saveJSON(KEY_PLAN, state.plan);
  showDashboard();
}

/* -------------------------
   Show / hide
   ------------------------- */
function showDashboard(){
  $('loginView').style.display='none';
  $('dashView').style.display='block';
  $('welcomeName').textContent = state.user.name || 'Student';
  $('welcomeDept').textContent = state.user.department || '';
  $('rightHeader').textContent = `${state.user.name || ''}`;
  // set plan UI
  $('startDate').value = state.plan.startDate || '';
  $('durationDays').value = state.plan.durationDays || 30;
  $('dailyTargetInput').value = state.plan.dailyTarget || 1;
  renderTopics();
  updateStats();
}
function logout(){
  state.user = null; saveJSON(KEY_USER, null);
  $('loginView').style.display='block';
  $('dashView').style.display='none';
}

/* -------------------------
   Topics UI
   ------------------------- */
function renderTopics(){
  const wrap = $('topicsList'); wrap.innerHTML = '';
  if(!state.topics || state.topics.length===0){
    wrap.innerHTML = '<div class="small" style="padding:12px;color:var(--muted)">No topics yet â€” add your topics above.</div>';
    return;
  }
  state.topics.forEach((t, i)=>{
    const div = document.createElement('div'); div.className='topic';
    const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = !!t.done;
    cb.addEventListener('change', () => {
      t.done = cb.checked;
      saveJSON(KEY_TOPICS, state.topics);
      playCheckSound();
      renderTopics();
      updateStats();
    });
    const title = document.createElement('div'); title.className='title'; title.textContent = t.title;
    const actions = document.createElement('div'); actions.className='actions';
    const editBtn = document.createElement('button'); editBtn.className='btn ghost'; editBtn.textContent='Edit';
    editBtn.addEventListener('click', ()=> {
      const v = prompt('Edit topic title', t.title);
      if(v){ t.title = v; saveJSON(KEY_TOPICS, state.topics); renderTopics(); }
    });
    const delBtn = document.createElement('button'); delBtn.className='btn ghost'; delBtn.textContent='Delete';
    delBtn.addEventListener('click', ()=> {
      if(confirm('Delete this topic?')){ state.topics.splice(i,1); saveJSON(KEY_TOPICS,state.topics); renderTopics(); updateStats(); }
    });
    actions.appendChild(editBtn); actions.appendChild(delBtn);
    div.appendChild(cb); div.appendChild(title); div.appendChild(actions);
    wrap.appendChild(div);
  });
}

/* -------------------------
   Stats / progress
   ------------------------- */
function updateStats(){
  const total = state.topics.length;
  const completed = state.topics.filter(t=>t.done).length;
  const percent = total ? Math.round((completed/total)*100) : 0;
  $('completedCount').textContent = completed;
  $('remainingCount').textContent = Math.max(0,total-completed);
  $('progressLabel').textContent = percent + '%';
  // stroke-dash (circle r=70 => circumference ~439.82)
  const offset = 439.82 - (439.82 * percent / 100);
  $('progBar').style.strokeDashoffset = offset;
  // glow effect when complete percent > 0
  $('progBar').style.filter = percent>0 ? 'drop-shadow(0 4px 18px rgba(255,0,0,0.25))' : 'none';
  // daily target
  const dailyTarget = state.plan.dailyTarget || parseInt($('dailyTargetInput').value || 1);
  $('dailyTarget').textContent = dailyTarget;
  // compute today's suggested target: remaining / days left
  const remaining = Math.max(0,total-completed);
  let todaySuggested = dailyTarget;
  if(state.plan.startDate){
    const start = new Date(state.plan.startDate);
    const dur = state.plan.durationDays || 30;
    const dayElapsed = Math.floor((new Date() - start) / (1000*60*60*24));
    const daysLeft = Math.max(1, dur - dayElapsed);
    todaySuggested = Math.ceil(remaining / daysLeft);
  }
  // show suggested in small (we put into dailyTarget as well)
  $('dailyTarget').textContent = `${dailyTarget} (today ~ ${todaySuggested})`;
}

/* -------------------------
   Save plan
   ------------------------- */
function savePlan(){
  state.plan.startDate = $('startDate').value || null;
  state.plan.durationDays = parseInt($('durationDays').value || 30);
  state.plan.dailyTarget = parseInt($('dailyTargetInput').value || 1);
  saveJSON(KEY_PLAN, state.plan);
  updateStats();
  alert('Plan saved.');
}

/* -------------------------
   Download / restore / reset
   ------------------------- */
function downloadData(){
  const data = { user: state.user, topics: state.topics, plan: state.plan, reminder: state.reminder, bgList: state.bgList };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'study-progress.json'; a.click(); URL.revokeObjectURL(url);
}
function restoreFromFile(){
  const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json';
  inp.onchange = async (e) => {
    const f = e.target.files[0]; if(!f) return;
    try {
      const txt = await f.text(); const d = JSON.parse(txt);
      if(d.user){ state.user = d.user; saveJSON(KEY_USER, state.user); }
      if(d.topics){ state.topics = d.topics; saveJSON(KEY_TOPICS, state.topics); }
      if(d.plan){ state.plan = d.plan; saveJSON(KEY_PLAN, state.plan); }
      if(d.reminder){ state.reminder = d.reminder; saveJSON(KEY_REMINDER, state.reminder); }
      renderTopics(); updateStats(); showDashboard();
      alert('Restored successfully.');
    } catch(err){ alert('Invalid file.'); }
  };
  inp.click();
}
function resetAll(){
  if(!confirm('Reset all local data (this will remove all topics & settings)?')) return;
  state.user = null; state.topics = []; state.plan = { startDate:null, durationDays:30, dailyTarget:1 }; state.reminder = null; state.bgList=[];
  saveJSON(KEY_USER, null); saveJSON(KEY_TOPICS, state.topics); saveJSON(KEY_PLAN, state.plan); saveJSON(KEY_REMINDER, null); saveJSON(KEY_BG, state.bgList);
  renderTopics(); updateStats(); logout();
}

/* -------------------------
   Reminder system (in-page)
   - requests Notification permission once
   - stores time (HH:MM) and checks every minute while page open
   ------------------------- */
function saveReminder(){
  const t = $('reminderTime').value;
  if(!t){ alert('Pick a time'); return; }
  state.reminder = { time: t };
  saveJSON(KEY_REMINDER, state.reminder);
  updateReminderUI();
  requestNotificationPermission();
}
function clearReminder(){
  state.reminder = null; saveJSON(KEY_REMINDER, null); updateReminderUI();
}
function updateReminderUI(){
  if(state.reminder && state.reminder.time){ $('reminderTime').value = state.reminder.time; $('reminderStatus').textContent = `Daily at ${state.reminder.time}`; } else { $('reminderTime').value=''; $('reminderStatus').textContent = 'No reminder set'; }
}
function requestNotificationPermission(){
  if(!('Notification' in window)) return;
  if(Notification.permission === 'default'){
    Notification.requestPermission().then(p=>{ if(p==='granted') console.log('Notifications allowed'); });
  }
}
function startReminderChecker(){
  setInterval(()=> {
    if(!state.reminder || !state.reminder.time) return;
    const now = new Date(); const hh = String(now.getHours()).padStart(2,'0'); const mm = String(now.getMinutes()).padStart(2,'0');
    const nowHM = `${hh}:${mm}`;
    // trigger at exact minute and only once per day â€” we track lastTriggered in state.reminder
    if(nowHM === state.reminder.time){
      const last = state.reminder.lastTriggered || null;
      const today = new Date().toDateString();
      if(last !== today){
        // show notification and speak if allowed
        if(Notification.permission === 'granted'){
          new Notification('Study Tracker reminder', { body: `Hi ${state.user ? state.user.name : 'Student'}, time to study!` });
        } else {
          // gentle fallback
          console.log('Reminder: time to study!');
        }
        state.reminder.lastTriggered = today;
        saveJSON(KEY_REMINDER, state.reminder);
      }
    }
  }, 60*1000); // check every minute
}

/* -------------------------
   Sound
   ------------------------- */
function playCheckSound(){
  const el = $('checkSound');
  if(el){ try{ el.currentTime = 0; el.play(); }catch(e){} }
}

/* -------------------------
   Small helpers & boot
   ------------------------- */
function editTopicsBulk(){
  if(!state.topics || state.topics.length===0) return alert('No topics to edit.');
  const cur = state.topics.map((t,i)=>`${i+1}. ${t.title}`).join('\n');
  const txt = prompt('Edit topics (one per line). Order matters.\n\n' + cur);
  if(!txt) return;
  const lines = txt.split('\n').map(s=>s.trim()).filter(Boolean);
  state.topics = lines.map(l=>({ title:l, done:false }));
  saveJSON(KEY_TOPICS, state.topics);
  renderTopics(); updateStats();
}

/* -------------------------
   Boot render / helpers
   ------------------------- */
function renderTopics(){ renderTopics; } // placeholder to avoid lint warnings
// replace with actual implementation (above). Already defined earlier.

function showLogin(){ $('loginView').style.display='block'; $('dashView').style.display='none'; }
function showDash(){ showDashboard(); }

/* Very small migration from earlier placeholder */
(function finalBoot(){
  // ensure saved topics & user are loaded
  state.user = loadJSON(KEY_USER, state.user);
  state.topics = loadJSON(KEY_TOPICS, state.topics);
  state.plan = loadJSON(KEY_PLAN, state.plan);
  state.reminder = loadJSON(KEY_REMINDER, state.reminder);
  state.bgList = loadJSON(KEY_BG, state.bgList);

  // wire some UI defaults
  if(state.user) showDashboard(); else showLogin();
  renderTopics();
  updateStats();
  updateReminderUI();
  startReminderChecker();
})();

</script>
</body>
</html>
